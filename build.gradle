package com.ilabeu.modules;

import com.ilabeu.addon.AddonTemplate;
import meteordevelopment.meteorclient.events.world.TickEvent;
import meteordevelopment.meteorclient.settings.*;
import meteordevelopment.meteorclient.systems.modules.Module;
import meteordevelopment.orbit.EventHandler;
import net.minecraft.entity.vehicle.BoatEntity;

public class BoatFly extends Module {
    private final SettingGroup sgGeneral = settings.getDefaultGroup();

    private final Setting<Double> speed = sgGeneral.add(new DoubleSetting.Builder()
        .name("speed")
        .description("Horizontal boat speed.")
        .defaultValue(1.0)
        .min(0.1)
        .sliderMax(5.0)
        .build()
    );

    private final Setting<Double> verticalSpeed = sgGeneral.add(new DoubleSetting.Builder()
        .name("vertical-speed")
        .description("Vertical speed (jump/sneak).")
        .defaultValue(1.0)
        .min(0.1)
        .sliderMax(5.0)
        .build()
    );

    private final Setting<Boolean> acceleration = sgGeneral.add(new BoolSetting.Builder()
        .name("acceleration")
        .description("Smooth acceleration.")
        .defaultValue(false)
        .build()
    );

    private final Setting<Double> accelerationSpeed = sgGeneral.add(new DoubleSetting.Builder()
        .name("acceleration-speed")
        .description("Acceleration rate.")
        .defaultValue(0.1)
        .min(0.01)
        .sliderMax(0.5)
        .visible(acceleration::get)
        .build()
    );

    private final Setting<Double> maxSpeed = sgGeneral.add(new DoubleSetting.Builder()
        .name("max-speed")
        .description("Max accelerated speed.")
        .defaultValue(2.0)
        .min(0.1)
        .sliderMax(10.0)
        .visible(acceleration::get)
        .build()
    );

    private final Setting<Boolean> deceleration = sgGeneral.add(new BoolSetting.Builder()
        .name("deceleration")
        .description("Smooth deceleration.")
        .defaultValue(true)
        .visible(acceleration::get)
        .build()
    );

    private final Setting<Double> decelerationSpeed = sgGeneral.add(new DoubleSetting.Builder()
        .name("deceleration-speed")
        .description("Deceleration rate.")
        .defaultValue(0.05)
        .min(0.01)
        .sliderMax(0.5)
        .visible(() -> acceleration.get() && deceleration.get())
        .build()
    );

    private double currentVelocity = 0.0;

    public BoatFly() {
        super(AddonTemplate.CATEGORY, "boat-fly", "Allows boats to fly.");
    }

    @Override
    public void onActivate() {
        currentVelocity = 0.0;
    }

    @Override
    public void onDeactivate() {
        restoreBoat();
        currentVelocity = 0.0;
    }

    @EventHandler
    private void onTick(TickEvent.Pre event) {
        if (mc.player == null) return;
        if (!(mc.player.getVehicle() instanceof BoatEntity)) return;

        BoatEntity boat = (BoatEntity) mc.player.getVehicle();
        boat.setNoGravity(true);

        boolean moving =
            mc.options.forwardKey.isPressed() ||
            mc.options.backKey.isPressed()
